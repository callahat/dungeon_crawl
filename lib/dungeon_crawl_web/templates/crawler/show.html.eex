<%= if @player_location do %>
<div class="text-center">
<pre id="short_comm">Move...</pre>
<%= render(DungeonCrawlWeb.SharedView, "dungeon.html", dungeon: @player_location.map_tile.dungeon, readonly: false) %>
<br/>
<%= link "Leave Dungeon", to: crawler_path(@conn, :destroy), method: :delete, data: [confirm: "No going back, are you sure?"], class: "btn btn-danger btn-xs" %>
</div>
<%= else %>
Not currently in any dungeon.
<br/>
<%= link "Generate and go solo", to: crawler_path(@conn, :create), method: :create, data: [confirm: "Are you sure?"], class: "btn btn-danger btn-xs" %>

<br/>
<br/>
Or join:

<table class="table table-striped">
  <thead>
    <tr>
      <th>Name</th>
      <th>Dimensions (HxW)</th>
      <th>Instances/Players</th>
    </tr>
  </thead>

  <tbody>
<%= for %{dungeon: dungeon} = all <- @dungeons do %>
    <tr>
      <td><%= dungeon.name %></td>
      <td><%= dungeon.height %>x<%= dungeon.width %></td>
      <td>
        <table class="table table-condensed">
        <%= for instance <- dungeon.map_instances do %>
          <tr>
            <td><%= instance.locations |> Enum.count %></td>
            <td>
              <span class="pull-right">
                <%= link "Join", to: crawler_path(@conn, :join, instance_id: instance.id), method: :post, data: [confirm: "Are you sure?"], class: "btn btn-danger btn-xs" %>
              </span>
            </td>
          </tr>
        <% end %>
          <tr>
            <td colspan=100%>
              <span class="pull-right">
                <%= link "Join New Instance", to: crawler_path(@conn, :join, dungeon_id: dungeon.id), method: :post, data: [confirm: "Are you sure?"], class: "btn btn-danger btn-xs" %>
              </span>
            </td>
          <tr>
        </table>
      </td>

    </tr>
<% end %>
  </tbody>
</table>

<% end %>
